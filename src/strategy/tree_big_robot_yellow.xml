<root main_tree_to_execute="MainTree">

    <BehaviorTree ID="MainTree">
        <Sequence name="root">
            <SubTree ID="ResetAX12"/>

            <SubTree ID="PickAllYellowAtoms"/>
            <SubTree ID="EmptyBarrelRight"/>

        </Sequence>
    </BehaviorTree>

    <!--    Global subtrees-->

    <BehaviorTree ID="ResetAX12">
        <Sequence>
            <MoveArmFront name="move arm to the back"
                          pos="950"/>
            <TurnArm name="turn arm to the center"
                     pos="510"/>
            <PushLeftAtom name="move arm to the back"
                          pos="1000"/>
            <PushRightAtom name="move arm to the back"
                           pos="140"/>
        </Sequence>
    </BehaviorTree>

    <BehaviorTree ID="PickAllPurpleAtoms">
        <Sequence>
            <!-- Move to atoms and adjust-->
            <MoveAhead name="move ahead"
                       distance="655"/>
            <Turn name="turn to the left (to be backwards)"
                  angle="-90"/>
            <MoveAhead name="move ahead"
                       distance="-142"/>
            <Turn name="adjust"
                  angle="-1"/>

            <!-- Pick up atoms-->
            <SubTree ID="PickAtomRight"/>
            <SetBlackboard output_key="barrelGoalPosition" value="9535"/>
            <SubTree ID="TurnBarrel"
                     barrelGoalPosition="barrelGoalPosition"/>

            <MoveAhead name="move ahead"
                       distance="-100"/>
            <SubTree ID="PickAtomRight"/>
            <SetBlackboard output_key="barrelGoalPosition" value="19070"/>
            <SubTree ID="TurnBarrel"
                     barrelGoalPosition="barrelGoalPosition"/>

            <MoveAhead name="move ahead"
                       distance="-100"/>
            <SubTree ID="PickAtomRight"/>
            <SetBlackboard output_key="barrelGoalPosition" value="28605"/>
            <SubTree ID="TurnBarrel"
                     barrelGoalPosition="barrelGoalPosition"/>

            <MoveAhead name="move ahead"
                       distance="-100"/>
            <SubTree ID="PickAtomRight"/>
            <SetBlackboard output_key="barrelGoalPosition" value="38140"/>
            <SubTree ID="TurnBarrel"
                     barrelGoalPosition="barrelGoalPosition"/>

            <MoveAhead name="move ahead"
                       distance="-100"/>
            <SubTree ID="PickAtomRight"/>
            <SetBlackboard output_key="barrelGoalPosition" value="47675"/>
            <SubTree ID="TurnBarrel"
                     barrelGoalPosition="barrelGoalPosition"/>

            <MoveAhead name="move ahead"
                       distance="-100"/>
            <SubTree ID="PickAtomRight"/>
            <SetBlackboard output_key="barrelGoalPosition" value="57210"/>
            <SubTree ID="TurnBarrel"
                     barrelGoalPosition="barrelGoalPosition"/>

            <!-- Move forward to do a U-turn, then go back to drop the atoms -->
            <MoveAhead name="move ahead"
                       distance="720"/>
            <Turn name="u turn"
                  angle="181"/>
            <MoveAhead name="move ahead"
                       distance="920"/>
        </Sequence>
    </BehaviorTree>

    <BehaviorTree ID="PickAllYellowAtoms">
        <Sequence>
            <!-- Move to atoms and adjust-->
            <MoveAhead name="move ahead"
                       distance="638"/>
            <Turn name="turn to the left"
                  angle="-90"/>
            <MoveAhead name="move ahead"
                       distance="265"/>
            <Turn name="adjust"
                  angle="-1"/>

            <!-- Pick up atoms -->
            <SubTree ID="PickAtomRight"/>
            <SetBlackboard output_key="barrelGoalPosition" value="9535"/>
            <SubTree ID="TurnBarrel"
                     barrelGoalPosition="barrelGoalPosition"/>

            <MoveAhead name="move ahead"
                       distance="100"/>
            <SubTree ID="PickAtomRight"/>
            <SetBlackboard output_key="barrelGoalPosition" value="19070"/>
            <SubTree ID="TurnBarrel"
                     barrelGoalPosition="barrelGoalPosition"/>

            <MoveAhead name="move ahead"
                       distance="100"/>
            <SubTree ID="PickAtomRight"/>
            <SetBlackboard output_key="barrelGoalPosition" value="28605"/>
            <SubTree ID="TurnBarrel"
                     barrelGoalPosition="barrelGoalPosition"/>

            <MoveAhead name="move ahead"
                       distance="100"/>
            <SubTree ID="PickAtomRight"/>
            <SetBlackboard output_key="barrelGoalPosition" value="38140"/>
            <SubTree ID="TurnBarrel"
                     barrelGoalPosition="barrelGoalPosition"/>

            <MoveAhead name="move ahead"
                       distance="100"/>
            <SubTree ID="PickAtomRight"/>
            <SetBlackboard output_key="barrelGoalPosition" value="47675"/>
            <SubTree ID="TurnBarrel"
                     barrelGoalPosition="barrelGoalPosition"/>

            <MoveAhead name="move ahead"
                       distance="100"/>
            <SubTree ID="PickAtomRight"/>
            <SetBlackboard output_key="barrelGoalPosition" value="57210"/>
            <SubTree ID="TurnBarrel"
                     barrelGoalPosition="barrelGoalPosition"/>

            <!-- Move to balance-->
            <MoveAhead name="move ahead"
                       distance="200"/>
        </Sequence>
    </BehaviorTree>

    <BehaviorTree ID="EmptyBarrelLeft">
        <Sequence>
            <SetBlackboard output_key="barrelGoalPosition" value="58340"/>
            <SubTree ID="TurnBarrel"
                     barrelGoalPosition="barrelGoalPosition"/>
            <SubTree ID="PushLeft"/>
            <SetBlackboard output_key="barrelGoalPosition" value="67875"/>
            <SubTree ID="TurnBarrel"
                     barrelGoalPosition="barrelGoalPosition"/>
            <SubTree ID="PushLeft"/>
            <SetBlackboard output_key="barrelGoalPosition" value="77410"/>
            <SubTree ID="TurnBarrel"
                     barrelGoalPosition="barrelGoalPosition"/>
            <SubTree ID="PushLeft"/>
            <SetBlackboard output_key="barrelGoalPosition" value="86945"/>
            <SubTree ID="TurnBarrel"
                     barrelGoalPosition="barrelGoalPosition"/>
            <SubTree ID="PushLeft"/>
            <SetBlackboard output_key="barrelGoalPosition" value="96480"/>
            <SubTree ID="TurnBarrel"
                     barrelGoalPosition="barrelGoalPosition"/>
            <SubTree ID="PushLeft"/>
            <SetBlackboard output_key="barrelGoalPosition" value="106015"/>
            <SubTree ID="TurnBarrel"
                     barrelGoalPosition="barrelGoalPosition"/>
            <SubTree ID="PushLeft"/>
        </Sequence>
    </BehaviorTree>

    <BehaviorTree ID="EmptyBarrelRight">
        <Sequence>
            <SetBlackboard output_key="barrelGoalPosition" value="65510"/>
            <SubTree ID="TurnBarrel"
                     barrelGoalPosition="barrelGoalPosition"/>
            <SubTree ID="PushRight"/>
            <SetBlackboard output_key="barrelGoalPosition" value="75045"/>
            <SubTree ID="TurnBarrel"
                     barrelGoalPosition="barrelGoalPosition"/>
            <SubTree ID="PushRight"/>
            <SetBlackboard output_key="barrelGoalPosition" value="84580"/>
            <SubTree ID="TurnBarrel"
                     barrelGoalPosition="barrelGoalPosition"/>
            <SubTree ID="PushRight"/>
            <SetBlackboard output_key="barrelGoalPosition" value="94115"/>
            <SubTree ID="TurnBarrel"
                     barrelGoalPosition="barrelGoalPosition"/>
            <SubTree ID="PushRight"/>
            <SetBlackboard output_key="barrelGoalPosition" value="103650"/>
            <SubTree ID="TurnBarrel"
                     barrelGoalPosition="barrelGoalPosition"/>
            <SubTree ID="PushRight"/>
            <SetBlackboard output_key="barrelGoalPosition" value="113185"/>
            <SubTree ID="TurnBarrel"
                     barrelGoalPosition="barrelGoalPosition"/>
            <SubTree ID="PushRight"/>
        </Sequence>
    </BehaviorTree>

    <!--    Basic subtrees-->

    <BehaviorTree ID="PickAtomLeft">
        <!--   NOT UP TO DATE   -->

        <Sequence>
            <Wait delay="1000"/>
            <!--            <MoveArmFront name="move arm to the back"-->
            <!--                          pos="800"-->
            <!--            />-->
            <!--            <MoveArmSideJoint name="move arm to the center (joint mode)"-->
            <!--                              pos="1023"-->
            <!--            />-->
            <!--            <TurnArm name="turn arm to the left"-->
            <!--                     pos="200"-->
            <!--            />-->

            <!--            <MoveArmSideJoint name="move arm to the left (new joint mode)"-->
            <!--                              pos="250"-->
            <!--            />-->

            <!--            <ActivatePump/>-->
            <!--            <Wait name="wait for the atom to be stuck"-->
            <!--                  delay="1000"/>-->

            <!--            <MoveArmSideJoint name="move arm back to the center (joint mode)"-->
            <!--                              pos="1023"-->
            <!--            />-->

            <!--            <TurnArm name="turn arm to the center"-->
            <!--                     pos="510"-->
            <!--            />-->
            <!--            <MoveArmFront name="move arm to the front"-->
            <!--                          pos="200"-->
            <!--            />-->

            <!--            <DeactivatePump/>-->
            <!--            <Wait name="wait for the atom to fall"-->
            <!--                  delay="500"/>-->

            <!--            <MoveArmFront name="move arm to the back"-->
            <!--                          pos="500"-->
            <!--            />-->
        </Sequence>
    </BehaviorTree>

    <BehaviorTree ID="PickAtomRight">
        <Sequence>
            <MoveArmFront name="move arm to the back"
                          pos="950"
            />

            <MoveArmSideJoint name="move arm to the center (joint mode)"
                              pos="235"
            />
            <TurnArm name="turn arm to the right"
                     pos="820"
            />

            <MoveArmSideJoint name="move arm to the right (joint mode)"
                              pos="1023"
            />

            <ActivatePump/>
            <Wait name="wait for the atom to be stuck"
                  delay="1000"/>

            <MoveArmSideJoint name="move arm back to the center (joint mode)"
                              pos="235"
            />

            <TurnArm name="turn arm to the center"
                     pos="510"
            />
            <MoveArmFront name="move arm to the front"
                          pos="460"
            />

            <DeactivatePump/>
            <Wait name="wait for the atom to fall"
                  delay="500"/>

            <MoveArmFront name="move arm to the back"
                          pos="950"
            />
        </Sequence>
    </BehaviorTree>

    <BehaviorTree ID="TurnBarrel">
        <Sequence>
            <ActivateBarrel name="start turning the barrel"/>
            <RetryUntilSuccesful num_attempts="1000000000">
                <IsBarrelMoveFinished name="check if the barrel has turned enough"
                                      goalPosition="{barrelGoalPosition}"/>
            </RetryUntilSuccesful>
            <DeactivateBarrel name="stop turning the barrel"/>
        </Sequence>
    </BehaviorTree>

    <BehaviorTree ID="PushLeft">
        <Sequence>
            <PushLeftAtom name="push it"
                          pos="530"/>
            <PushLeftAtom name="come back"
                          pos="1000"/>
        </Sequence>
    </BehaviorTree>

    <BehaviorTree ID="PushRight">
        <Sequence>
            <PushRightAtom name="push it"
                           pos="600"/>
            <PushRightAtom name="come back"
                           pos="140"/>
        </Sequence>
    </BehaviorTree>
</root>
